#pragma once

////////////////////////////////////////////////////////////
// Headers
////////////////////////////////////////////////////////////

#include <nlohmann/json.hpp>
#include <sstream>
#include <unordered_map>
#include <vector>

#include "TextEdit.h"

namespace ls6502
{

//////////////////////////////////////////////////////////////
///
/// Typedefs
///
//////////////////////////////////////////////////////////////
typedef std::unordered_map<std::string, std::vector<TextEdit>> ChangesT;

//////////////////////////////////////////////////////////////
///
/// @class WorkspaceEdit
///
/// @brief Represents a collection of text edits to be
///        applied to one or more documents.
///
//////////////////////////////////////////////////////////////
class WorkspaceEdit
{
  public:
    //////////////////////////////////////////////////////////////
    ///
    /// @brief Default constructor for WorkspaceEdit.
    ///
    //////////////////////////////////////////////////////////////
    WorkspaceEdit() = default;

    //////////////////////////////////////////////////////////////
    ///
    /// @brief Adds a new change (a pair of file path and text edits)
    ///        to the workspace edit.
    ///
    /// @param [in] textEdit A pair consisting of a file
    ///        path (string) and a vector of TextEdit objects.
    ///
    //////////////////////////////////////////////////////////////
    void addChange(const std::pair<std::string, std::vector<TextEdit>> &textEdit);

    //////////////////////////////////////////////////////////////
    ///
    /// @brief Converts the WorkspaceEdit to a JSON representation.
    ///
    /// @return A JSON object representing the WorkspaceEdit.
    ///
    //////////////////////////////////////////////////////////////
    nlohmann::json toJson() const;

    //////////////////////////////////////////////////////////////
    ///
    /// @brief Converts the WorkspaceEdit to a string representation.
    ///
    /// @return A string representation of the WorkspaceEdit.
    ///
    //////////////////////////////////////////////////////////////
    std::string toString() const;

  private:
    //////////////////////////////////////////////////////////////
    ///
    /// @brief A map of file paths to text edit operations.
    ///
    //////////////////////////////////////////////////////////////
    ChangesT m_changes;
};

} // namespace ls6502
